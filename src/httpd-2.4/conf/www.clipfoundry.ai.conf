<VirtualHost *:443>
    ServerName www.clipfoundry.ai
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/www.clipfoundry.ai/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/www.clipfoundry.ai/privkey.pem
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"

    ProxyPreserveHost On
    LimitRequestFieldSize 16384

    # Regular HTTP proxying
    ProxyPass / http://walpole.clipfoundry.ai:8800/
    ProxyPassReverse / http://walpole.clipfoundry.ai:8800/

    ErrorLog /appz/log/clipfoundry-error.log
    CustomLog /appz/log/clipfoundry-access.log combined
</VirtualHost>

# Existing VirtualHost for www.clipfoundry.ai (HTTP to HTTPS)
<VirtualHost *:80>
    ServerName www.clipfoundry.ai
    <Location "/server-status">
        SetHandler server-status
        Require all granted
    </Location>

    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/server-status
    RewriteRule ^/(.*)$ https://www.clipfoundry.ai/$1 [R=301,L]

    ErrorLog /appz/log/clipfoundry-http-error.log
    CustomLog /appz/log/clipfoundry-http-access.log combined
</VirtualHost>

